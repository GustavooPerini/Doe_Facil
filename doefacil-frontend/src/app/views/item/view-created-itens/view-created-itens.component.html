<div class="container">
  <div class="header">
    <h2>Meus Itens Anunciados</h2>
  </div>

  <div *ngIf="loading">Carregando...</div>
  <div class="error" *ngIf="error">{{ error }}</div>

  <div class="grid" *ngIf="page">
    <div class="card" *ngFor="let it of page.content">
      <div class="title">{{ it.title }}</div>
      <div class="muted">{{ it.category }} • {{ it.city }}/{{ it.state }}</div>
      <div class="status" [attr.data-status]="it.status">{{ it.status }}</div>
      <div class="desc">{{ it.description }}</div>

      <button class="btn" (click)="openInterestsModal(it)">
        Interessados
        <ng-container *ngIf="interests[it.id]">({{ interests[it.id].length }})</ng-container>
      </button>
    </div>
  </div>
  
  <div class="modal-backdrop" *ngIf="modalOpen">
    <div class="modal">
      <div class="modal-header">
        <h3 class="gugu">Interessados: {{ modalItem?.title }}</h3>
        <button class="close-btn" (click)="closeModal()">×</button>
      </div>

      <div class="modal-body">
        <div class="muted" *ngIf="modalItem && interestsLoading[modalItem.id]">Carregando interessados...</div>
        <div class="error" *ngIf="modalItem && interestsError[modalItem.id]">{{ interestsError[modalItem.id] }}</div>

        <ng-container *ngIf="modalItem">
          <div class="interest-row" *ngFor="let intr of interests[modalItem.id]">
            <div class="who">
              <div class="name">{{ intr.requesterName }}</div>
              <div class="email muted">{{ intr.requesterEmail }}</div>
              <div class="msg">{{ intr.message }}</div>
              <div class="muted small">{{ intr.createdAt | date:'short' }}</div>
            </div>

            <div class="actions">
              <span class="badge" [attr.data-status]="intr.status">{{ intr.status }}</span>

              <button class="accept"
                      (click)="decide(intr.id, modalItem.id, true)"
                      [disabled]="intr.status !== 'PENDING' || decisionLoading[intr.id]">
                {{ decisionLoading[intr.id] ? 'Enviando...' : 'Aceitar' }}
              </button>

              <button class="reject"
                      (click)="decide(intr.id, modalItem.id, false)"
                      [disabled]="intr.status !== 'PENDING' || decisionLoading[intr.id]">
                Recusar
              </button>
            </div>
          </div>

          <div class="muted" *ngIf="!interestsLoading[modalItem.id] && (interests[modalItem.id]?.length || 0) === 0">
            Nenhum interessado ainda.
          </div>
        </ng-container>
      </div>

      <div class="modal-footer">
        <button class="cancel-btn" (click)="closeModal()">Fechar</button>
      </div>
    </div>
  </div>

  <div class="pager" *ngIf="page">
    <button (click)="prev()" [disabled]="page.number === 0">Anterior</button>
    <span>Página {{ page.number + 1 }} de {{ page.totalPages || 1 }}</span>
    <button (click)="next()" [disabled]="page.number >= (page.totalPages - 1)">Próxima</button>
  </div>
</div>